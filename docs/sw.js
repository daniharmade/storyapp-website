import{precacheAndRoute}from"workbox-precaching";import{registerRoute}from"workbox-routing";import{CacheableResponsePlugin}from"workbox-cacheable-response";import{NetworkFirst,CacheFirst,StaleWhileRevalidate}from"workbox-strategies";import{BASE_URL}from"./config";const manifest=self.__WB_MANIFEST;precacheAndRoute(manifest),registerRoute((({url:e})=>"https://fonts.googleapis.com"===e.origin||"https://fonts.gstatic.com"===e.origin),new CacheFirst({cacheName:"google-fonts"})),registerRoute((({url:e})=>"https://cdnjs.cloudflare.com"===e.origin||e.origin.includes("fontawesome")),new CacheFirst({cacheName:"fontawesome"})),registerRoute((({url:e})=>"https://ui-avatars.com"===e.origin),new CacheFirst({cacheName:"avatars-api",plugins:[new CacheableResponsePlugin({statuses:[0,200]})]})),registerRoute((({request:e,url:i})=>new URL(BASE_URL).origin===i.origin&&"image"!==e.destination),new NetworkFirst({cacheName:"citycare-api"})),registerRoute((({request:e,url:i})=>new URL(BASE_URL).origin===i.origin&&"image"===e.destination),new StaleWhileRevalidate({cacheName:"citycare-api-images"})),registerRoute((({url:e})=>e.origin.includes("maptiler")),new CacheFirst({cacheName:"maptiler-api"})),self.addEventListener("push",(e=>{console.log("Service worker pushing...");let i={title:"CityCare Notification",options:{body:"You have a new notification!",icon:"/images/icons/icon-x144.png",badge:"/images/icons/icon-x144.png"}};if(e.data)try{const t=e.data.json();"story_created"===t.type&&(i={title:"Story berhasil dibuat",options:{body:`Anda telah membuat story baru dengan deskripsi: ${t.description}`,icon:"/images/icons/icon-x144.png",badge:"/images/icons/icon-x144.png"}})}catch(e){console.error("Error parsing push event data:",e)}e.waitUntil(self.registration.showNotification(i.title,i.options))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),e.waitUntil(clients.openWindow("/#/"))})),self.addEventListener("message",(e=>{if(console.log("Service worker received message:",e.data),e.data&&"story_created"===e.data.type){const i={title:"Story berhasil dibuat",options:{body:`Anda telah membuat story baru dengan deskripsi: ${e.data.description}`,icon:"/images/icons/icon-x144.png",badge:"/images/icons/icon-x144.png"}};e.waitUntil(self.registration.showNotification(i.title,i.options))}}));